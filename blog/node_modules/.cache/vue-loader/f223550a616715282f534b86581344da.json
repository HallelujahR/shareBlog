{"remainingRequest":"/usr/local/var/www/blog/blog/node_modules/vue-loader/lib/index.js??vue-loader-options!/usr/local/var/www/blog/blog/src/components/User/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/usr/local/var/www/blog/blog/src/components/User/index.vue","mtime":1547790966345},{"path":"/usr/local/var/www/blog/blog/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/usr/local/var/www/blog/blog/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/usr/local/var/www/blog/blog/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { mapGetters, mapMutations } from 'vuex'\nexport default {\n  data () {\n    return {\n      state: false,//判断是不是本人\n      user: {},//用户基本信息\n      detail: {},//用户详情\n      loading: true,\n      width: '',\n      height: 230,\n      //初始化背景图插件\n      croppa: {},\n      //初始化图片滑动放大缩小input range\n      sliderVal: 0,\n      sliderMin: 0,\n      sliderMax: 0,\n      root: '',//网站api根目录\n      alterImgFlag: true,//是否出现处理背景图片按钮\n      freshFlag: false,//判断是否上传过图片\n      alterDetail: true,//跳转到编辑个人资料开关\n      cursorFlag: false,//控制鼠标在背景图上的样式\n      centerDialogVisible: false,//修改头像的对话框控制\n    }\n  },\n  computed: {\n    ...mapGetters([\n      'verbState',//登录状态\n      'token',//登录的用户的token\n      'self',//获取当前登录的用户信息\n    ]),\n  },\n  //监听路由变化\n  watch: {\n    $route () {\n      //获取网页url判断是否在更改详情页面\n      if (this.$route.path.endsWith('alterDetail')) this.alterDetail = false;\n    }\n  },\n  created: function () {\n\n    //获取浏览器窗口的宽度 然后赋值给背景图片宽度\n    this.width = window.screen.width;\n    //判断是否登录\n    this.state = localStorage.getItem('verbState');\n    //获取路由传递过来的用户id\n    this.id = this.$route.params.id;\n\n    //数据\n    let paramsObj = {\n      id: this.id,\n    }\n    //发送axios 获取传递过来id对用的用户的数据\n    this.$server.getInformation(paramsObj).then(data => {\n      //获取到用户的基本信息\n      this.user = data;\n      //获取到用户的详细信息\n      this.detail = data.user_detail;\n      //判断用户是否有背景图片 且是否是本人页面 然后更改高度\n      //之所以使用定时器 是因为我别无他法 只能用定时器延迟然后获取数据\n      setTimeout(() => {\n        if (this.user.backgroundImg != null || this.user.id == this.self.id) {\n          this.state = true;\n          this.height = 430;\n        }\n      }, 200);\n\n    }).catch(err => {\n      // eslint-disable-next-line no-console\n      console.log(err);\n    })\n  },\n  mounted: function () {\n    //网页加载状态\n    this.loading = false;\n    //api地址\n    this.root = this.$URL;\n    //获取网页url判断是否在更改详情页面\n    if (this.$route.path.endsWith('alterDetail')) this.alterDetail = false;\n  },\n  methods: {\n    ...mapMutations({\n      setuser: 'SET_USER',\n    }),\n    onFileTypeMismatch () {\n      this.$message({\n        message: '文件格式不对呦 😳',\n        type: 'warning',\n      })\n    },\n    onNewImage () {\n      this.sliderVal = this.croppa.scaleRatio\n      this.sliderMin = this.croppa.scaleRatio / 2\n      this.sliderMax = this.croppa.scaleRatio * 5\n    },\n\n    onSliderChange (evt) {\n      var increment = evt.target.value\n      this.croppa.scaleRatio = +increment\n    },\n\n    onZoom () {\n      // To prevent zooming out of range when using scrolling to zoom\n      // if (this.sliderMax && this.croppa.scaleRatio >= this.sliderMax) {\n      //   this.croppa.scaleRatio = this.sliderMax\n      // } else if (this.sliderMin && this.croppa.scaleRatio <= this.sliderMin) {\n      //   this.croppa.scaleRatio = this.sliderMin\n      // }\n\n      this.sliderVal = this.croppa.scaleRatio\n    },\n    upload () {\n\n      //判断是否有图片选中\n      if (!this.croppa.hasImage()) {\n        this.$message({\n          message: '你还没有选择图片 😳',\n          type: 'warning'\n        });\n\n        return false;\n      }\n\n      //获取到文件 但是是blob 二进制资源\n      this.croppa.generateBlob((blob) => {\n        //二进制转文件\n        const file = new File([blob], 'backImg', {\n          type: 'image/jpeg',\n        });\n        var fd = new FormData()\n        fd.append('image', file);\n        fd.append('type', 'backgroundImg');\n\n        //发送axios更改图片\n        this.$server.uploadImg(fd).then(data => {\n          //更改默认图片路径\n          this.detail.backgroundImg = data;\n          //更改按钮状态\n          this.alterImgFlag = !this.alterImgFlag;\n          //上传成功提示\n          this.$message({\n            type: 'success',\n            message: '上传成功 😊'\n          });\n        }).catch(err => {\n          // eslint-disable-next-line no-console\n          console.log('err', err);\n        })\n\n\n        return false;\n      })\n    },\n    alterImg () {\n      this.alterImgFlag = !this.alterImgFlag;\n      this.cursorFlag = !this.cursorFlag;\n      this.croppa.refresh()\n    },\n    removeBackgroundImg () {\n      this.$confirm('移除背景, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n\n        //参数\n        let paramsObj = {\n          type: 'backgroundImg',\n        }\n        //发送axios 删除图片\n        this.$server.deleteImg(paramsObj).then(data => {\n          if (data == 2) {\n            this.$message({\n              type: 'warning',\n              message: '还没有背景图 😓'\n            });\n            return false;\n          }\n          //更改默认图片路径\n          this.detail.backgroundImg = '';\n          //触发插件移除\n          this.croppa.remove();\n          //成功提示\n          this.$message({\n            type: 'success',\n            message: '移除成功!'\n          });\n          //更改按钮状态\n          this.alterImgFlag = !this.alterImgFlag;\n\n        }).catch(err => {\n          // eslint-disable-next-line no-console\n          console.log(err)\n        })\n\n      }).catch(() => {\n        this.$message({\n          type: 'info',\n          message: '已取消'\n        });\n      });\n    },\n    alterDetails () {\n      this.alterDetail = !this.alterDetail;\n    },\n    //更改头像的croppa 更改为圆圈\n    onInit () {\n      this.croppa.addClipPlugin(function (ctx, x, y, w, h) {\n        /*\n         * ctx: canvas context\n         * x: start point (top-left corner) x coordination\n         * y: start point (top-left corner) y coordination\n         * w: croppa width\n         * h: croppa height\n        */\n\n        ctx.beginPath()\n        ctx.arc(x + w / 2, y + h / 2, w / 2, 0, 2 * Math.PI, true)\n        ctx.closePath()\n      })\n    },\n    //上传头像的方法\n    uploadAvatar () {\n\n      //判断是否有图片选中\n      if (!this.croppa.hasImage()) {\n        this.$message({\n          message: '你还没有选择图片 😳',\n          type: 'warning'\n        });\n\n        return false;\n      }\n\n      //获取到文件 但是是blob 二进制资源\n      this.croppa.generateBlob((blob) => {\n        //二进制转文件\n        const file = new File([blob], 'backImg', {\n          type: 'image/jpeg',\n        });\n        var fd = new FormData()\n        fd.append('image', file);\n        fd.append('type', 'avatar');\n\n        //发送axios更改图片\n        this.$server.uploadImg(fd).then(data => {\n\n          if (data == 2) {\n            //上传失败提示\n            this.$message({\n              type: 'success',\n              message: '上传失败 😓'\n            });\n            return false;\n          }\n          //上传成功提示\n          this.$message({\n            type: 'success',\n            message: '上传成功 😊'\n          });\n\n          //更改默认图片路径\n          this.user.avatar = data;\n          this.setuser(this.user);\n          this.centerDialogVisible = false;//修改头像的对话框控制\n        }).catch(err => {\n          // eslint-disable-next-line no-console\n          console.log('err', err);\n        })\n        return false;\n      })\n    },\n    //点击取消修改头像按钮\n    noEditAvatar () {\n      this.croppa.refresh();\n    },\n    //移除头像\n    removeAvatarImg () {\n      this.$confirm('移除背景头像, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n\n        //参数\n        let paramsObj = {\n          type: 'avatar',\n        }\n        //发送axios 删除图片\n        this.$server.deleteImg(paramsObj).then(data => {\n          if (data == 2) {\n            this.$message({\n              type: 'warning',\n              message: '还没有头像 😓'\n            });\n            return false;\n          }\n          //更改默认图片路径\n          this.user.avatar = '';\n          //触发插件移除\n          this.croppa.remove();\n          //成功提示\n          this.$message({\n            type: 'success',\n            message: '移除成功!'\n          });\n          this.user.avatar = '';\n          this.setuser(this.user);\n\n\n        }).catch(err => {\n          // eslint-disable-next-line no-console\n          console.log(err)\n        })\n\n      }).catch(() => {\n        this.$message({\n          type: 'info',\n          message: '已取消'\n        });\n      });\n    }\n  }\n}\n",null]}