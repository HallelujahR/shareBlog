{"remainingRequest":"/usr/local/var/www/blog/blog/node_modules/babel-loader/lib/index.js!/usr/local/var/www/blog/blog/node_modules/cache-loader/dist/cjs.js??ref--0-0!/usr/local/var/www/blog/blog/node_modules/vue-loader/lib/index.js??vue-loader-options!/usr/local/var/www/blog/blog/src/components/loginOrRegister/register.vue?vue&type=script&lang=js&","dependencies":[{"path":"/usr/local/var/www/blog/blog/src/components/loginOrRegister/register.vue","mtime":1542605563213},{"path":"/usr/local/var/www/blog/blog/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/usr/local/var/www/blog/blog/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/usr/local/var/www/blog/blog/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/usr/local/var/www/blog/blog/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.array.iterator\";\nimport \"core-js/modules/es6.promise\";\nimport \"core-js/modules/es7.promise.finally\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nexport default {\n  data: function data() {\n    return {\n      show: false,\n      //表单数据\n      ruleForm: {\n        account: '',\n        password: '',\n        name: '',\n        yzm: '',\n        sms: ''\n      },\n      //验证码图片\n      captchas: '',\n      //验证码的key\n      captcha_key: '',\n      //是否显示验证码输入框\n      showcaptchas: false,\n      //是否显示短信验证\n      showSms: false,\n      //短信验证码的key\n      smskey: '',\n      //控制下一步按钮是否可以点击\n      isdis: false,\n      issendSms: false,\n      //自定义错误消息\n      errorMsg: '',\n      errorphone: '',\n      errorSms: '',\n      errorName: '',\n      //验证码刷新等待\n      isreloadYzm: true,\n      rules: {\n        account: [{\n          required: true,\n          message: '请输入账号',\n          trigger: 'blur'\n        }, {\n          min: 3,\n          max: 20,\n          message: '长度在 3 到 20 个字符',\n          trigger: 'blur'\n        }, {\n          pattern: /^1[34578]\\d{9}$/,\n          message: '手机号格式不正确',\n          trigger: 'blur'\n        }],\n        yzm: [{\n          required: true,\n          message: '请输入验证码',\n          trigger: 'blur'\n        }],\n        sms: [{\n          required: true,\n          message: '请输入短信验证码',\n          trigger: 'blur'\n        }],\n        name: [{\n          required: true,\n          message: '请输入昵称',\n          trigger: 'blur'\n        }, {\n          min: 2,\n          max: 10,\n          message: '长度在 2 到 10 个字符',\n          trigger: 'blur'\n        }],\n        password: [{\n          required: true,\n          message: '请输入密码',\n          trigger: 'blur'\n        }, // {pattern:/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,16}$/, message:\"请输入密码，不可以全是字母或数字,且长度在8位以上\",trigger:'blur'},\n        {\n          min: 6,\n          max: 20,\n          message: '长度在 6 到 20 个字符',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    setTimeout(function () {\n      _this.show = true;\n    }, 200);\n  },\n  methods: {\n    register: function register() {\n      this.$emit('log', true);\n    },\n    getCap: function getCap(formName, field) {\n      //验证手机号是否正确进行下一步\n      var _this = this;\n\n      _this.errorphone = ''; //使用了element ui 的form组件 个别字段验证  验证手机号\n\n      this.$refs[formName].validateField(field, function (valid) {\n        if (valid == '') {\n          //验证手机获取图片验证码\n          axios.post('http://api.rivered.cn/captchas', {\n            phone: _this.ruleForm.account\n          }).then(function (response) {\n            console.log(response); //把获取到的图片和key 传递给下一个步骤\n\n            _this.captchas = response.data.captcha_image_content;\n            _this.captcha_key = response.data.captcha_key;\n            _this.showcaptchas = true;\n            _this.isdis = true;\n            _this.isreloadYzm = true;\n          }).catch(function (error) {\n            if (error.response.data.status_code == 429) {\n              _this.errorphone = '操作次数错过，请稍后再试';\n              _this.showcaptchas = false;\n            } else if (error.response.data.status_code == 422) {\n              _this.errorphone = '电话号已存在';\n            }\n          });\n          return false;\n        }\n\n        return false;\n      });\n    },\n    //监听用户是否改变手机号 重新获取验证码\n    oninput: function oninput() {\n      this.isdis = false;\n      this.showcaptchas = false;\n      this.ruleForm.yzm = '';\n    },\n    reloadYzm: function reloadYzm() {\n      var _this2 = this;\n\n      this.isreloadYzm = false;\n      setTimeout(function () {\n        _this2.getCap('ruleForm', 'account');\n      }, 500);\n    },\n    checkYzm: function checkYzm(formName, field, event) {\n      var _this3 = this;\n\n      var _this = this; //请空自定义消息\n\n\n      _this.errorMsg = ''; //使用了element ui 的form组件 个别字段验证 验证 验证码\n\n      this.$refs[formName].validateField(field, function (valid) {\n        if (valid == '') {\n          axios.post('http://api.blog.com/verificationCodes', {\n            captcha_key: _this.captcha_key,\n            captcha_code: _this.ruleForm.yzm\n          }).then(function (response) {\n            var num = 60;\n            var time = setInterval(function () {\n              event.target.innerHTML = num;\n              num--;\n\n              if (num == 0) {\n                clearInterval(time);\n                _this.issendSms = false;\n                event.target.innerHTML = '发送短信';\n              }\n            }, 1000);\n            _this.issendSms = true; //存入验证短信验证码的key\n\n            _this.smskey = response.data.key; //显示密码 昵称等输入框\n\n            _this.showSms = true;\n          }).catch(function (error) {\n            if (error.response.data.status_code == 401) {\n              _this.getCap('ruleForm', 'yzm');\n\n              _this.errorMsg = error.response.data.message;\n            } else if (error.response.data.status_code == 429) {\n              _this.errorMsg = '操作次数过多，请稍后再试'; //让输入验证码input 消失\n\n              _this3.isdis = false;\n              _this3.showcaptchas = false;\n              _this3.ruleForm.yzm = '';\n            } else if (error.response.data.status_code == 422) {\n              _this.errorMsg = '图片验证码已失效,点就图片重新获取';\n            }\n          });\n          return false;\n        }\n\n        return false;\n      });\n    },\n    //提交注册\n    regNow: function regNow(formName, field1, field2, field3) {\n      var _this4 = this;\n\n      console.log(1);\n\n      var _this = this; //name\n\n\n      var name = ''; //pass\n\n      var pass = ''; //sms\n\n      var sms = ''; //昵称验证\n\n      this.$refs[formName].validateField(field1, function (valid) {\n        name = valid;\n      }); //密码验证\n\n      this.$refs[formName].validateField(field2, function (valid) {\n        pass = valid;\n      }); //短信验证码验证\n\n      if (pass == '' && name == '') {\n        this.$refs[formName].validateField(field3, function (valid) {\n          console.log(valid);\n\n          if (valid == '') {\n            console.log(_this.smskey);\n            console.log(_this.ruleForm.password);\n            console.log(_this.ruleForm.name); //判断短信验证码是否完成注册\n\n            axios.post('http://api.blog.com/users', {\n              verification_key: _this.smskey,\n              password: _this.ruleForm.password,\n              name: _this.ruleForm.name,\n              phone: _this.ruleForm.phone,\n              verification_code: _this.ruleForm.sms\n            }).then(function (response) {\n              _this4.$notify({\n                title: '成功',\n                message: '注册成功，开始您的流域',\n                type: 'success'\n              });\n\n              console.log(response);\n\n              _this.register();\n            }).catch(function (error) {\n              if (error.response.data.status_code == 422) {\n                _this.errorName = '昵称已存在';\n              } else if (error.response.data.status_code == 401) {\n                _this.errorSms = '验证码错误';\n              } else if (error.response.data.status_code == 423) {\n                _this.errorSms = '验证码失效，请重新发送';\n\n                _this.getCap('ruleForm', 'account');\n              }\n            });\n          }\n\n          return false;\n        });\n      }\n    }\n  }\n};",{"version":3,"sources":["register.vue"],"names":[],"mappings":"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","sourcesContent":["<style type=\"scoped\" lang=\"scss\">\n@import '@/assets/css/register.scss';\n</style>\n\n<template>\n\t<div>\n\t\t<div id=\"register\">\n\t\t\t<div id=\"register-title\">\n\t\t\t\t加入流域\n\t\t\t</div>\n\n\t\t\t<el-form :model=\"ruleForm\" :rules=\"rules\" ref=\"ruleForm\" class=\"demo-ruleForm\">\n\t\t\t\t<div class=\"register-user\">\n\t\t\t\t\t<el-form-item prop=\"account\" :error=\"errorphone\">\n\t\t\t\t\t\t<el-input\n\t\t\t\t\t\t    placeholder=\"输入手机号\"\n\t\t\t\t\t\t    suffix-icon=\"el-icon-phone\"\n\t\t\t\t\t\t    v-model=\"ruleForm.account\"\n\t\t\t\t\t\t    id=\"register-user-input0\"\n\t\t\t\t\t\t    @input=\"oninput()\"\n\t\t\t\t\t\t    >\n\t\t\t\t\t\t    <el-button :disabled='isdis' @click=\"getCap('ruleForm', 'account')\" slot=\"append\">下一步</el-button>\n\t\t\t\t\t\t</el-input>\n\t\t\t\t\t</el-form-item>\n\t\t\t\t</div>\n\t\t\t\t<transition-group name=\"slide-fade\">\n\t\t\t\t<div :key=\"1\" class=\"register-user\" v-if=\"showcaptchas\" >\n\t\t\t\t\t<el-form-item prop=\"yzm\" :error=\"errorMsg\" >\n\t\t\t\t\t\t<el-input\n\t\t\t\t\t\t    placeholder=\"输入验证码\"\n\t\t\t\t\t\t    suffix-icon=\"el-icon-document\"\n\t\t\t\t\t\t    v-model=\"ruleForm.yzm\"\n\t\t\t\t\t\t    id=\"register-user-input\"\n\n\t\t\t\t\t\t    >\n\n\t\t\t\t\t\t    <el-button  slot=\"prepend\" style=\"padding:0px;\">\n\t\t\t\t\t\t    \t<img v-if=\"isreloadYzm\" @click=\"reloadYzm()\" width=\"120px\" style=\"margin-top:11px;\" :src=\"captchas\">\n\t\t\t\t\t\t    \t<i v-else class=\"el-icon-loading\"></i>\n\t\t\t\t\t\t    </el-button>\n\n\n\t\t\t\t\t\t\t<el-button :disabled='issendSms'  slot=\"append\" @click=\"checkYzm('ruleForm', 'yzm', $event)\" style=\"width:84px;padding:0px;\">发送短信</el-button>\n\t\t\t\t\t\t</el-input>\n\t\t\t\t\t</el-form-item>\n\t\t\t\t</div>\n\n\t\t\t\t<div :key=\"2\" class=\"register-user\" v-if=\"showSms\" >\n\t\t\t\t\t<el-form-item :error=\"errorName\" prop=\"name\">\n\t\t\t\t\t\t<el-input\n\t\t\t\t\t\t    placeholder=\"输入昵称\"\n\t\t\t\t\t\t    suffix-icon=\"el-icon-tickets\"\n\t\t\t\t\t\t    v-model=\"ruleForm.name\"\n\t\t\t\t\t\t    id=\"register-user-input3\"\n\t\t\t\t\t\t    >\n\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t</el-input>\n\t\t\t\t\t</el-form-item>\n\n\t\t\t\t\t<el-form-item prop=\"password\">\n\t\t\t\t\t\t<el-input\n\t\t\t\t\t\t    placeholder=\"请输入密码\"\n\t\t\t\t\t\t    suffix-icon=\"el-icon-edit-outline\"\n\t\t\t\t\t\t    v-model=\"ruleForm.password\"\n\t\t\t\t\t\t    id=\"register-user-input4\"\n\t\t\t\t\t\t    type=\"password\"\n\t\t\t\t\t\t    >\n\n\t\t\t\t\t\t</el-input>\n\t\t\t\t\t</el-form-item>\n\n\t\t\t\t\t<el-form-item prop=\"sms\" :error=\"errorSms\">\n\t\t\t\t\t\t<el-input\n\t\t\t\t\t\t    placeholder=\"输入短信验证码\"\n\t\t\t\t\t\t    suffix-icon=\"el-icon-message\"\n\t\t\t\t\t\t    v-model=\"ruleForm.sms\"\n\t\t\t\t\t\t    id=\"register-user-input5\"\n\t\t\t\t\t\t    >\n\n\t\t\t\t\t\t\t<el-button slot=\"append\" @click=\"regNow('ruleForm','name', 'password', 'sms')\">注册</el-button>\n\n\t\t\t\t\t\t</el-input>\n\t\t\t\t\t</el-form-item>\n\n\t\t\t\t</div>\n\n\t\t\t\t</transition-group>\n\t\t\t</el-form>\n\n\t\t\t<div id=\"register-ds\">\n\t\t\t\t<span style=\"float:left\">第三方登录:</span>\n\t\t\t\t<img class=\"register-icon\" src=\"@/assets/qqicon.png\" /> \n\t\t\t\t<img class=\"register-icon\" src=\"@/assets/weibo.png\" />\n\n\t\t\t\t<div class=\"register\"  @click=\"register()\" style=\"margin-left:200px;\">已有账号？立即账号</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\n\texport default {\n\t\tdata(){\n\t\t\treturn {\n\t\t\t\tshow:false,\n\t\t\t\t//表单数据\n\t\t\t\truleForm:{\n\t\t\t\t\taccount:'',\n\t\t\t\t\tpassword:'',\n\t\t\t\t\tname:'',\n\t\t\t\t\tyzm:'',\n\t\t\t\t\tsms:'',\n\t\t\t\t},\n\t\t\t\t//验证码图片\n\t\t\t\tcaptchas:'',\n\t\t\t\t//验证码的key\n\t\t\t\tcaptcha_key:'',\n\t\t\t\t//是否显示验证码输入框\n\t\t\t\tshowcaptchas:false,\n\t\t\t\t//是否显示短信验证\n\t\t\t\tshowSms:false,\n\t\t\t\t//短信验证码的key\n\t\t\t\tsmskey:'',\n\n\t\t\t\t//控制下一步按钮是否可以点击\n\t\t\t\tisdis:false,\n\t\t\t\tissendSms:false,\n\n\t\t\t\t//自定义错误消息\n\t\t\t\terrorMsg:'',\n\t\t\t\terrorphone:'',\n\t\t\t\terrorSms:'',\n\t\t\t\terrorName:'',\n\n\t\t\t\t//验证码刷新等待\n\t\t\t\tisreloadYzm:true,\n\n\t\t\t\trules:{\n\t\t\t\t\taccount: [\n\t\t\t            { required: true, message: '请输入账号', trigger: 'blur' },\n\t\t\t            { min: 3, max: 20, message: '长度在 3 到 20 个字符', trigger: 'blur' },\n\t\t\t            { pattern: /^1[34578]\\d{9}$/, message: '手机号格式不正确',trigger: 'blur'}\n          \t\t\t],\n          \t\t\tyzm: [\n          \t\t\t\t{required:true, message:'请输入验证码',trigger: 'blur'}\n          \t\t\t],\n          \t\t\tsms: [\n          \t\t\t\t{required:true, message:'请输入短信验证码',trigger:'blur'}\n          \t\t\t],\n          \t\t\tname: [\n          \t\t\t\t{required: true,message:'请输入昵称' , trigger:'blur'},\n          \t\t\t\t{min:2,max:10, message:'长度在 2 到 10 个字符' ,  trigger:'blur'}\n          \t\t\t],\n          \t\t\tpassword:[\n          \t\t\t\t{required: true,message:'请输入密码', trigger:'blur' },\n          \t\t\t\t// {pattern:/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,16}$/, message:\"请输入密码，不可以全是字母或数字,且长度在8位以上\",trigger:'blur'},\n          \t\t\t\t{min:6, max:20, message:'长度在 6 到 20 个字符',trigger:'blur'}\n          \t\t\t],\n          \t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t    mounted:function(){\n\t      var _this = this;\n\t      setTimeout(function(){ _this.show = true} ,200);\n\t    },\n\t    methods:{\n\t\t    register() {\n\t\t    \tthis.$emit('log',true);\n\t\t    },\n\t\t    getCap(formName, field) {\n\n\t\t    \t//验证手机号是否正确进行下一步\n\t\t    \tvar _this = this;\n\t\t\t\t_this.errorphone = '';\n\t\t    \t//使用了element ui 的form组件 个别字段验证  验证手机号\n\t    \t  \tthis.$refs[formName].validateField(field,(valid) => {\n\n\t\t    \t\tif(valid == ''){\n\n\t\t    \t\t\t//验证手机获取图片验证码\n\t\t\t\t    \taxios.post('http://api.rivered.cn/captchas',{\n\t\t\t\t    \t\tphone:_this.ruleForm.account,\n\t\t\t            })\n\t\t\t            .then(response => {\n\t\t\t            \tconsole.log(response);\n\t\t\t            \t//把获取到的图片和key 传递给下一个步骤\n\t\t\t            \t_this.captchas = response.data.captcha_image_content;\n\t\t\t            \t_this.captcha_key = response.data.captcha_key;\n\t\t\t            \t_this.showcaptchas = true;\n\t\t\t            \t_this.isdis = true;\n\n\t\t\t            \t_this.isreloadYzm = true;\n\t\t\t            })\t\n\t\t\t            .catch(error => {\n\t\t\t            \tif (error.response.data.status_code == 429) {\n\n\t\t\t            \t\t_this.errorphone = '操作次数错过，请稍后再试';\n\t\t\t            \t\t_this.showcaptchas = false;\n\n\t    \t  \t\t\t\t}else if(error.response.data.status_code == 422) {\n\t\t\t            \t\t_this.errorphone = '电话号已存在';\n\n\t    \t  \t\t\t\t}\n\t\t\t            });\n\n\t\t    \t\t\treturn false;\n\n\t\t    \t\t}\n\n\t\t    \t\treturn false;\n\n\t\t    \t})\n\n\t\t    },\n\t\t    //监听用户是否改变手机号 重新获取验证码\n\t\t    oninput() {\n\t\t    \tthis.isdis = false;\n\t\t    \tthis.showcaptchas = false;\n\t\t    \tthis.ruleForm.yzm = '';\n\t\t    },\n\t\t    reloadYzm() {\n\t\t    \tthis.isreloadYzm =false;\n\t\t    \tsetTimeout(()=>{ this.getCap('ruleForm','account'); },500)\n\t\t    },\n\t\t    checkYzm(formName, field, event) {\n\n\t\t    \tvar _this = this;\n\n\t\t    \t//请空自定义消息\n\t\t    \t_this.errorMsg = '';\n\t\t    \t//使用了element ui 的form组件 个别字段验证 验证 验证码\n\t    \t  \tthis.$refs[formName].validateField(field,(valid) => {\n\n\t    \t  \t\tif(valid == ''){\n\n\t    \t  \t\t\taxios.post('http://api.blog.com/verificationCodes',{\n\t    \t  \t\t\t\tcaptcha_key:_this.captcha_key,\n\t    \t  \t\t\t\tcaptcha_code:_this.ruleForm.yzm,\n\t    \t  \t\t\t})\n\t    \t  \t\t\t.then(response => {\n\t    \t  \t\t\t\tvar num = 60;\n\t    \t  \t\t\t\tvar time = setInterval(() => {\n\t    \t  \t\t\t\t\tevent.target.innerHTML=num;\t\n\t    \t  \t\t\t\t\tnum--;\n\t    \t  \t\t\t\t\tif(num == 0) {\n\t\t\t\t\t\t\t\t\tclearInterval(time);\n\t\t\t\t\t\t\t\t\t_this.issendSms = false;\n\t\t\t\t\t\t\t\t\tevent.target.innerHTML='发送短信';\t\n\t    \t  \t\t\t\t\t}\n\t    \t  \t\t\t\t} ,1000);\n\n\t    \t  \t\t\t\t_this.issendSms = true;\n\n\t    \t  \t\t\t\t//存入验证短信验证码的key\n\t    \t  \t\t\t\t_this.smskey = response.data.key;\n\n\t    \t  \t\t\t\t//显示密码 昵称等输入框\n\t    \t  \t\t\t\t_this.showSms = true;\n\n\n\t    \t  \t\t\t\t\n\n\t    \t  \t\t\t})\n\t    \t  \t\t\t.catch(error => {\n\n\t    \t  \t\t\t\tif (error.response.data.status_code == 401) {\n\n\t    \t  \t\t\t\t\t_this.getCap('ruleForm', 'yzm');\n\t\t\t            \t\t_this.errorMsg = error.response.data.message;\n\n\t    \t  \t\t\t\t}else if(error.response.data.status_code == 429) {\n\n\t    \t  \t\t\t\t\t_this.errorMsg = '操作次数过多，请稍后再试';\n\t    \t  \t\t\t\t\t//让输入验证码input 消失\n\t    \t  \t\t\t\t\tthis.isdis = false;\n\t\t\t\t\t\t    \tthis.showcaptchas = false;\n\t\t\t\t\t\t    \tthis.ruleForm.yzm = '';\n\n\t    \t  \t\t\t\t}else if(error.response.data.status_code == 422) {\n\n\t    \t  \t\t\t\t\t_this.errorMsg = '图片验证码已失效,点就图片重新获取';\n\t    \t  \t\t\t\t\t\n\n\t    \t  \t\t\t\t}\n\t    \t  \t\t\t\t\n\t    \t  \t\t\t})\n\n\t    \t  \t\t\treturn false;\n\n\t    \t  \t\t}\n\n\t    \t  \t\treturn false;\n\n\t    \t  \t})\n\t\t    },\n\t\t    //提交注册\n\t\t    regNow(formName, field1, field2, field3) {\n\t\t    \tconsole.log(1);\n\t\t    \tvar _this = this;\n\t\t    \t//name\n\t\t    \tvar name = '';\n\t\t    \t//pass\n\t\t    \tvar pass = '';\n\t\t    \t//sms\n\t\t    \tvar sms = '';\n\n\t\t    \t//昵称验证\n\t\t    \tthis.$refs[formName].validateField(field1,(valid) => {\n\t\t    \t\tname = valid;\n\t\t    \t});\n\t\t    \t//密码验证\n\t\t    \tthis.$refs[formName].validateField(field2,(valid) => {\n\t\t    \t\tpass = valid;\n\t\t    \t});\n\n\t\t    \t//短信验证码验证\n\t\t    \tif(pass == '' && name== ''){\n\n\t\t    \t\tthis.$refs[formName].validateField(field3,(valid) => {\n\t\t    \t\t\tconsole.log(valid);\n\t\t\t\t\t\tif(valid == ''){\n\t\t\t\t\t\t\tconsole.log(_this.smskey);\n\t\t\t\t\t\t\tconsole.log(_this.ruleForm.password);\n\t\t\t\t\t\t\tconsole.log(_this.ruleForm.name);\n\t\t\t\t\t\t\t//判断短信验证码是否完成注册\n\t\t\t\t\t\t\taxios.post('http://api.blog.com/users',{\n\t\t\t\t\t\t\t\tverification_key:_this.smskey,\n\t\t\t\t\t\t\t\tpassword:_this.ruleForm.password,\n\t\t\t\t\t\t\t\tname:_this.ruleForm.name,\n\t\t\t\t\t\t\t\tphone:_this.ruleForm.phone,\n\t\t\t\t\t\t\t\tverification_code:_this.ruleForm.sms,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.then(response => {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tthis.$notify({\n\t\t\t\t\t\t          title: '成功',\n\t\t\t\t\t\t          message: '注册成功，开始您的流域',\n\t\t\t\t\t\t          type: 'success'\n\t\t\t\t\t\t        });\n\t\t\t\t\t\t\t\tconsole.log(response);\n\t\t\t\t\t\t        _this.register();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\t\t\tif (error.response.data.status_code == 422) {\n\t\t\t\t\t\t\t\t\t_this.errorName = '昵称已存在';\n\t\t\t\t\t\t\t\t}else if(error.response.data.status_code == 401){\n\t\t\t\t\t\t\t\t\t_this.errorSms = '验证码错误';\n\t\t\t\t\t\t\t\t}else if(error.response.data.status_code == 423){\n\t\t\t\t\t\t\t\t\t_this.errorSms = '验证码失效，请重新发送';\n\t\t\t\t\t\t\t\t\t_this.getCap('ruleForm','account');\n\t\t\t\t\t\t\t\t}\t\n\n\n\t\t\t\t\t\t\t})\n\n\t\t\t    \t\t}\n\n\t\t\t    \t\treturn false;\n\t\t    \t\t});\n\t\t    \t}\n\n\n\t\t    }\n\n\t    }\n\n\t}\n</script>"],"sourceRoot":"src/components/loginOrRegister"}]}